(window.webpackJsonp=window.webpackJsonp||[]).push([[10],{170:function(e,t,n){"use strict";n.r(t);var a=n(0),s=Object(a.a)({},function(){this.$createElement;this._self._c;return this._m(0)},[function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"content"},[n("h1",{attrs:{id:"docker-and-ngnix"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#docker-and-ngnix","aria-hidden":"true"}},[e._v("#")]),e._v(" Docker and Ngnix")]),e._v(" "),n("blockquote",[n("p",[e._v("Set up docker-compose to run nginx and serve the sample web site.")])]),e._v(" "),n("h2",{attrs:{id:"workshop-instructions"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#workshop-instructions","aria-hidden":"true"}},[e._v("#")]),e._v(" Workshop Instructions")]),e._v(" "),n("p",[e._v("Read over the description of how to create the Docker files and then see below for instructions on how to launch the app.")]),e._v(" "),n("h2",{attrs:{id:"the-docker-files"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#the-docker-files","aria-hidden":"true"}},[e._v("#")]),e._v(" The docker files")]),e._v(" "),n("p",[e._v("By now you've set up and built the sample web client as described previously.\nWe now need to serve the site with a production web server and we'll use nginx.\nWe want to run nginx in its own docker container and it turns out this is very easy to do.")]),e._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[e._v("mkdir nginx\necho 'FROM nginx' > nginx/DOCKERFILE\n")])])]),n("p",[e._v("We'll add more to this file soon.")]),e._v(" "),n("p",[e._v("nginx/DOCKERFILE")]),e._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[e._v("FROM nginx\n")])])]),n("p",[e._v("The docker-compose file is more interesting. It links our static web site to the nginx.")]),e._v(" "),n("p",[e._v("./stage2-docker-compose.yml")]),e._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[e._v('version: "3"\nservices:\n  nginx:\n    container_name: nginx-stage2\n    build:\n      context: ./nginx\n      dockerfile: Dockerfile\n    ports:\n      - "8083:80"\n    volumes:\n      - "./client-stage2/my-project/dist/:/usr/share/nginx/html/"\n')])])]),n("p",[e._v("Note the port mapping sets us up for development. On your development box open a browser and navigate to\nhttp://localhost:8083.  What you see is the same as what will be served from the production server.\nBut on a production server we need to serve pages on port 80. We also want to set the nginx flag to restart after a reboot.\nTo do this we create an override file. Overrides replace values in the main docker file.")]),e._v(" "),n("p",[e._v("./stage2-prod-override.yml")]),e._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[e._v('version: "3"\nservices:\n  nginx:\n    ports:\n      - "80:80"\n    restart: "always"      \n')])])]),n("h2",{attrs:{id:"launch-the-app-on-dev"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#launch-the-app-on-dev","aria-hidden":"true"}},[e._v("#")]),e._v(" Launch the app on dev")]),e._v(" "),n("p",[e._v("To run production on your development box:")]),e._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[e._v("docker-compose -f stage2-docker-compose.yml up --build\n")])])]),n("p",[e._v("See your app at http://localhost:8083")]),e._v(" "),n("h3",{attrs:{id:"mac-setup"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#mac-setup","aria-hidden":"true"}},[e._v("#")]),e._v(" Mac setup")]),e._v(" "),n("p",[e._v("Did you see an error like the following on the Mac development environment?")]),e._v(" "),n("blockquote",[n("p",[e._v("ERROR: for nginx-stage2  Cannot start service nginx: b'Mounts denied:\nThe path ... is not shared from OS X\nand is not known to Docker. You can configure shared paths from Docker -> Preferences... -> File Sharing.\nSee https://docs.docker.com/docker-for-mac/osxfs/#namespaces for more info.'")])]),e._v(" "),n("p",[e._v("As it says you need to open the Docker preferences and add in the path to your web site static files.")]),e._v(" "),n("h2",{attrs:{id:"launch-the-app-on-prod"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#launch-the-app-on-prod","aria-hidden":"true"}},[e._v("#")]),e._v(" Launch the app on prod")]),e._v(" "),n("p",[e._v("Use ssh to return to your production server and return to your project folder.")]),e._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[e._v("# on production\n\ncd client-stage2\nnpm install # only needed once per install\ncd my-project\nnpm install # only needed after updating Vue project packages\n\nnpm run build  # do this after changes on you web site.\n\ncd ../..  # return to project root\n\n# Launch the app with production overrides\nsudo docker-compose -f stage2-docker-compose.yml -f stage2-prod-override.yml up --build\n")])])]),n("p",[e._v("After a moment you will see")]),e._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[e._v("Creating nginx-stage2 ... done\nAttaching to nginx-stage2\n")])])]),n("p",[e._v("This is when you can open a browser and see your app at http://<your server ip address>")]),e._v(" "),n("p",[e._v("This is end of stage 2.")])])}],!1,null,null,null);t.default=s.exports}}]);